(function(){var P=YAHOO.util.Dom,N=YAHOO.util.Event;var M=Alfresco.util.encodeHTML,G=Alfresco.util.combinePaths,F=Alfresco.util.siteURL,S=Alfresco.util.isValueSet;var i;Alfresco.doclib.Actions={};Alfresco.doclib.Actions.prototype={actionsView:null,onRegisterAction:function y(ac,ab){var ad=ab[1];if(ad&&S(ad.actionName)&&S(ad.fn)){this.registerAction(ad.actionName,ad.fn)}else{Alfresco.logger.error("DL_onRegisterAction: Custom action registion invalid: "+ad)}},registerAction:function c(ab,ac){if(S(ab)&&S(ac)){this.constructor.prototype[ab]=ac;return true}return false},renderAction:function R(ac,af){var ab=Alfresco.constants.URL_RESCONTEXT+"components/documentlibrary/actions/",ah='style="background-image:url('+ab+'{icon}-16.png)" ',ae={link:'<div class="{id}"><a title="{label}" class="simple-link" href="{href}" '+ah+"{target}><span>{label}</span></a></div>",pagelink:'<div class="{id}"><a title="{label}" class="simple-link" href="{pageUrl}" '+ah+"><span>{label}</span></a></div>",javascript:'<div class="{id}" id="{jsfunction}"><a title="{label}" class="action-link" href="#"'+ah+"><span>{label}</span></a></div>"};af.actionParams[ac.id]=ac.params;var ad={id:ac.id,icon:ac.icon,label:M(Alfresco.util.substituteDotNotation(this.msg(ac.label),af))};if(ac.type==="link"){if(ac.params.href){ad.href=Alfresco.util.substituteDotNotation(ac.params.href,af);ad.target=ac.params.target?'target="'+ac.params.target+'"':""}else{Alfresco.logger.warn("Action configuration error: Missing 'href' parameter for actionId: ",ac.id)}}else{if(ac.type==="pagelink"){if(ac.params.page){ad.pageUrl=Alfresco.util.substituteDotNotation(ac.params.page,af);if(ac.params.page.charAt(0)!=="{"){var ag=S(af.location.site)?af.location.site.name:null;ad.pageUrl=F(ad.pageUrl,{site:ag})}}else{Alfresco.logger.warn("Action configuration error: Missing 'page' parameter for actionId: ",ac.id)}}else{if(ac.type==="javascript"){if(ac.params["function"]){ad.jsfunction=ac.params["function"]}else{Alfresco.logger.warn("Action configuration error: Missing 'function' parameter for actionId: ",ac.id)}}}}return YAHOO.lang.substitute(ae[ac.type],ad)},getActionUrls:function t(ah,ac){var ae=ah.jsNode,ak=ae.isLink?ae.linkedNode.nodeRef:ae.nodeRef,ak=ae.isLink&&!S(ak)?"invalidlink":ak,ai=ak.toString(),ab=ak.uri,ag=ae.contentURL,al=ah.workingCopy||{},ad=S(ah.location.site)?ah.location.site.name:null,aj=Alfresco.util.bind(function(am){return Alfresco.util.siteURL(am,{site:YAHOO.lang.isString(ac)?ac:ad})},this),af={downloadUrl:G(Alfresco.constants.PROXY_URI,ag)+'?a=true" target="_blank',viewUrl:G(Alfresco.constants.PROXY_URI,ag)+'" target="_blank',documentDetailsUrl:aj("document-details?nodeRef="+ai),folderDetailsUrl:aj("folder-details?nodeRef="+ai),editMetadataUrl:aj("edit-metadata?nodeRef="+ai),inlineEditUrl:aj("inline-edit?nodeRef="+ai),managePermissionsUrl:aj("manage-permissions?nodeRef="+ai),manageTranslationsUrl:aj("manage-translations?nodeRef="+ai),workingCopyUrl:aj("document-details?nodeRef="+(al.workingCopyNodeRef||ai)),workingCopySourceUrl:aj("document-details?nodeRef="+(al.sourceNodeRef||ai)),cloudViewUrl:G(Alfresco.constants.URL_SERVICECONTEXT,"cloud/cloudUrl?nodeRef="+ai)};af.sourceRepositoryUrl=this.viewInSourceRepositoryURL(ah,af)+'" target="_blank';return af},getAction:function Z(ac,ab,ag){var ai=ab.className,af=Alfresco.util.findInArray(ac.actions,ai,"id")||{};if(ag===false){return af}else{af=Alfresco.util.deepCopy(af);var ah=af.params||{};for(var ad in ah){ah[ad]=YAHOO.lang.substitute(ah[ad],ac,function ae(ak,al,aj){return Alfresco.util.findValueByDotNotation(ac,ak)})}return af}},getParentNodeRef:function Y(ac){var af=null;if(YAHOO.lang.isArray(ac)){try{af=this.doclistMetadata.parent.nodeRef}catch(ag){af=null}if(af===null){for(var ae=1,ad=ac.length,ab=true;ae<ad&&ab;ae++){ab=(ac[ae].parent.nodeRef==ac[ae-1].parent.nodeRef)}af=ab?ac[0].parent.nodeRef:this.doclistMetadata.container}}else{af=ac.parent.nodeRef}return af},onActionDetails:function H(ae){var ak=this,ag=ae.nodeRef,ad=ae.jsNode;var ai=function ab(am,an){var al='<span class="light">'+M(ae.displayName)+"</span>";Alfresco.util.populateHTML([an.id+"-dialogTitle",ak.msg("edit-details.title",al)]);this.widgets.editMetadata=Alfresco.util.createYUIButton(an,"editMetadata",null,{type:"link",label:ak.msg("edit-details.label.edit-metadata"),href:F("edit-metadata?nodeRef="+ag)})};var ac=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"node",itemId:ag,mode:"edit",submitType:"json",formId:"doclib-simple-metadata"});var aj=new Alfresco.module.SimpleDialog(this.id+"-editDetails-"+Alfresco.util.generateDomId());aj.setOptions({width:"auto",templateUrl:ac,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:ai,scope:this},onSuccess:{fn:function af(am){var ao="components/documentlibrary/data";if(S(this.options.siteId)){ao+="/site/"+encodeURIComponent(this.options.siteId)}Alfresco.util.Ajax.request({url:G(Alfresco.constants.URL_SERVICECONTEXT,ao,"/node/",ad.nodeRef.uri)+"?view="+this.actionsView,successCallback:{fn:function an(aq){var ap=aq.json.item;ap.jsNode=new Alfresco.util.Node(aq.json.item.node);YAHOO.Bubbling.fire(ap.node.isContainer?"folderRenamed":"fileRenamed",{file:ap});YAHOO.Bubbling.fire("tagRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.success")});this._updateDocList.call(this)},scope:this},failureCallback:{fn:function al(ap){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}})},scope:this},onFailure:{fn:function ah(al){var am=this.msg("message.details.failure");if(al.json&&al.json.message.indexOf("Failed to persist field 'prop_cm_name'")!==-1){am=this.msg("message.details.failure.name")}Alfresco.util.PopupManager.displayMessage({text:am})},scope:this}}).show()},onActionLocate:function X(ab){var ad=ab.jsNode,af=ab.location.path,ac,ae=S(ab.location.site)?ab.location.site.name:null;if(ad.isLink){ac=S(ad.linkedNode.properties)?ad.linkedNode.properties.name:null;Alfresco.util.PopupManager.displayMessage({text:this.msg("message.actions.failure.locate")})}else{ac=ab.displayName}if(S(this.options.siteId)&&ae!==this.options.siteId){window.location=F((ae===null?"repository":"documentlibrary")+"?file="+encodeURIComponent(ac)+"&path="+encodeURIComponent(af),{site:ae})}else{this.options.highlightFile=ac;YAHOO.Bubbling.fire("changeFilter",{filterId:"path",filterData:af})}},onActionDelete:function Q(af){var aj=this,ad=af.jsNode,ai=ad.isContainer?"folder":"document",al=af.displayName,ae=(this.options.syncMode==="CLOUD"),ak=0;var an=this.msg("message.confirm.delete",al);if(ad.hasAspect("sync:syncSetMemberNode")){if(ae){if(ad.hasAspect("sync:deleteOnPrem")){an+=this.msg("actions.synced.cloud."+ai+".delete.on.prem",al)}else{an+=this.msg("actions.synced.cloud."+ai+".delete",al)}}else{an+=this.msg("actions.synced."+ai+".delete",al)}}if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||P.hasClass(this.id,"alf-fullscreen"))){ak=1000}var am=undefined;var ac=P.get(this.id);var ab=navigator.userAgent.toLowerCase();if((ab.indexOf("gecko")!=-1||ab.indexOf("safari")!=-1)&&ab.indexOf("chrome")==-1){am=ac}Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+ai+".delete"),text:an,noEscape:true,zIndex:ak,buttons:[{text:this.msg("button.delete"),handler:function ah(){this.destroy();aj._onActionDeleteConfirm.call(aj,af)}},{text:this.msg("button.cancel"),handler:function ag(){this.destroy()},isDefault:true}]},am)},_onActionDeleteConfirm:function V(ae){var ab=ae.jsNode,aj=ae.location.path,ad=ae.location.file,ac=G(aj,ad),ag=ae.displayName,ah=ab.nodeRef,af=this.getParentNodeRef(ae);this.modules.actions.genericAction({success:{activity:{siteId:this.options.siteId,activityType:ab.isContainer?"folder-deleted":"file-deleted",page:"documentlibrary",activityData:{fileName:ad,path:aj,nodeRef:ah.toString(),parentNodeRef:af.toString()}},event:{name:ab.isContainer?"folderDeleted":"fileDeleted",obj:{path:ac}},message:this.msg("message.delete.success",ag),callback:{fn:function ai(ak,al){if(this.totalRecords){this.totalRecords-=ak.json.successCount}},scope:this}},failure:{message:this.msg("message.delete.failure",ag)},webscript:{method:Alfresco.util.Ajax.DELETE,name:"file/node/{nodeRef}",params:{nodeRef:ah.uri}},wait:{message:this.msg("message.multiple-delete.please-wait")}})},onActionEditOffline:function b(ab){Alfresco.logger.error("onActionEditOffline","Abstract implementation not overridden")},onlineEditMimetypes:{"application/msword":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word.Document","application/vnd.ms-word.document.macroenabled.12":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"Word.Document","application/vnd.ms-word.template.macroenabled.12":"Word.Document","application/vnd.ms-powerpoint":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.presentation":"PowerPoint.Slide","application/vnd.ms-powerpoint.presentation.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"PowerPoint.Slide","application/vnd.ms-powerpoint.slideshow.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.template":"PowerPoint.Slide","application/vnd.ms-powerpoint.template.macroenabled.12":"PowerPoint.Slide","application/vnd.ms-powerpoint.addin.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slide":"PowerPoint.Slide","application/vnd.ms-powerpoint.slide.macroEnabled.12":"PowerPoint.Slide","application/vnd.ms-excel":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"Excel.Sheet","application/vnd.ms-excel.sheet.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.template.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.addin.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.sheet.binary.macroenabled.12":"Excel.Sheet","application/vnd.visio":"Visio.Drawing"},onActionEditOnline:function m(ab){if(!S(ab.onlineEditUrl)){ab.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,ab.location)}if(ab.onlineEditUrl.length>260){Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:Alfresco.constants.PROXY_URI+"/api/sites/"+ab.location.site.name,successCallback:{fn:function(ac){var ag=ac.json.node.split("/").pop();var ae=ab.nodeRef.split("/").pop();ab.onlineEditUrl=ab.onlineEditUrl.split(ab.location.site.name)[0]+"_IDX_SITE_"+ag+"/_IDX_NODE_"+ae+"/"+ab.displayName;if(ab.onlineEditUrl.length>260){var ad=ab.displayName.split(".").pop();var af=ab.displayName.split(".")[0];var ah=ab.onlineEditUrl.length-260;ab.onlineEditUrl=ab.onlineEditUrl.replace(ab.displayName,af.substring(0,af.length-ah-1)+"."+ad)}this.actionEditOnlineInternal(ab)},scope:this},failureCallback:{fn:function(ac){this.actionEditOnlineInternal(ab)},scope:this}})}else{this.actionEditOnlineInternal(ab)}},actionEditOnlineInternal:function m(ab){if(ab.onlineEditUrl.length>260){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.path.failure")})}else{if(this._launchOnlineEditor(ab)){YAHOO.Bubbling.fire("metadataRefresh")}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.failure")})}}},_launchOnlineEditor:function B(af){var ai="SharePoint.OpenDocuments",ac=af.jsNode,ag=af.location,ak=ac.mimetype,ad=null,ae=null,ab={doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",docm:"application/vnd.ms-word.document.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dotm:"application/vnd.ms-word.template.macroenabled.12",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",pptm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppsm:"application/vnd.ms-powerpoint.slideshow.macroenabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",potm:"application/vnd.ms-powerpoint.template.macroenabled.12",ppam:"application/vnd.ms-powerpoint.addin.macroenabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xltm:"application/vnd.ms-excel.template.macroenabled.12",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12"};if(!Alfresco.util.validLocationForOnlineEdit(ag)){Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.invalid",ag.file)});return true}if(this.onlineEditMimetypes.hasOwnProperty(ak)){ad=this.onlineEditMimetypes[ak]}else{var ah=Alfresco.util.getFileExtension(af.location.file);if(ah!==null){ah=ah.toLowerCase();if(ab.hasOwnProperty(ah)){ak=ab[ah];if(this.onlineEditMimetypes.hasOwnProperty(ak)){ad=this.onlineEditMimetypes[ak]}}}}if(ad!==null){if(!S(af.onlineEditUrl)){af.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,ag)}if(YAHOO.env.ua.ie>0){return this._launchOnlineEditorIE(ai,af,ad)}if((YAHOO.env.ua.chrome>0)&&!Alfresco.util.isSharePointPluginInstalled()){var ah=Alfresco.util.getFileExtension(ag.file);if(null!==ah){var aj=this.getProtocolForFileExtension(ah.toLowerCase());return this._launchOnlineEditorChrome(aj,af.onlineEditUrl)}}if(Alfresco.util.isSharePointPluginInstalled()){return this._launchOnlineEditorPlugin(af,ad)}else{Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.failure",ag.file)});return false}}return window.open(af.onlineEditUrl,"_blank")},_launchOnlineEditorChrome:function h(af,ae){var ab=af+":ofe%7Cu%7C"+ae;var ag=false;var ac=document.createElement("input");var ad=document.body.scrollTop+10;ac.setAttribute("style","z-index: 1000; background-color: rgba(0, 0, 0, 0); border: none; outline: none; position: absolute; left: 10px; top: "+ad+"px;");document.getElementsByTagName("body")[0].appendChild(ac);ac.focus();ac.onblur=function(){ag=true};location.href=ab;setTimeout(function(){ac.onblur=null;ac.remove();if(!ag){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.supported_office_version_required")})}},500)},getProtocolForFileExtension:function(ac){var ab={doc:"ms-word",docx:"ms-word",docm:"ms-word",dot:"ms-word",dotx:"ms-word",dotm:"ms-word",xls:"ms-excel",xlsx:"ms-excel",xlsb:"ms-excel",xlsm:"ms-excel",xlt:"ms-excel",xltx:"ms-excel",xltm:"ms-excel",xlsm:"ms-excel",ppt:"ms-powerpoint",pptx:"ms-powerpoint",pot:"ms-powerpoint",potx:"ms-powerpoint",potm:"ms-powerpoint",pptm:"ms-powerpoint",potm:"ms-powerpoint",pps:"ms-powerpoint",ppsx:"ms-powerpoint",ppam:"ms-powerpoint",ppsm:"ms-powerpoint",sldx:"ms-powerpoint",sldm:"ms-powerpoint"};return ab[ac]},_launchOnlineEditorIE:function I(ad,ab,ac){try{if(ac==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}activeXControl=new ActiveXObject(ad+".3");return activeXControl.EditDocument3(window,ab.onlineEditUrl,true,ac)}catch(af){try{activeXControl=new ActiveXObject(ad+".2");return activeXControl.EditDocument2(window,ab.onlineEditUrl,ac)}catch(ag){try{activeXControl=new ActiveXObject(ad+".1");return activeXControl.EditDocument(ab.onlineEditUrl,ac)}catch(ae){}}}return false},_launchOnlineEditorPlugin:function g(ac,ad){var ae=document.getElementById("SharePointPlugin");if(ae==null&&Alfresco.util.isSharePointPluginInstalled()){var ab=null;if(YAHOO.env.ua.webkit&&Alfresco.util.isBrowserPluginInstalled("application/x-sharepoint-webkit")){ab="application/x-sharepoint-webkit"}else{ab="application/x-sharepoint"}var ai=document.createElement("object");ai.id="SharePointPlugin";ai.type=ab;ai.width=0;ai.height=0;ai.style.setProperty("visibility","hidden","");document.body.appendChild(ai);ae=document.getElementById("SharePointPlugin");if(!ae){return false}}try{if(ad==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}return ae.EditDocument3(window,ac.onlineEditUrl,true,ad)}catch(ag){try{return ae.EditDocument2(window,ac.onlineEditUrl,ad)}catch(ah){try{return ae.EditDocument(ac.onlineEditUrl,ad)}catch(af){return false}}}},onActionEditOnlineAos:function L(ab){if(!S(ab.onlineEditUrlAos)){ab.onlineEditUrlAos=Alfresco.util.onlineEditUrlAos(this.doclistMetadata.custom.aos,ab)}var ae=Alfresco.util.getFileExtension(ab.location.file);var ac=this.getProtocolForFileExtension(ae);if(ac===undefined){Alfresco.logger.error("onActionEditOnlineAos","No protocol handler available for file extension.");return}var ad=new EmbeddedOfficeLauncher();if(ad.isIOS()){this._aos_launchOfficeOnIos(ad,ac,ab.onlineEditUrlAos);return}if(!ad.isWin()&&!ad.isMac()){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.no_supported_environment")});return}if(ad.isAvailable()){this._aos_launchOfficeByPlugin(ad,ab.onlineEditUrlAos)}else{this._aos_tryToLaunchOfficeByMsProtocolHandler(ad,ac,ab.onlineEditUrlAos)}return},_aos_launchOfficeByPlugin:function x(af,ad){var ac,ah;var ae=(af.isFirefox()||af.isChrome()||af.isSafari());if(!af.EditDocument(ad)){if(af.isControlNotActivated()&&ae){ac=window.setInterval(function(){if(af.isControlActivated()){window.clearInterval(ac);ah.destroy();window.setTimeout(function(){if(!af.EditDocument(ad)){if(af.getLastControlResult()!==-2){var ai=af.getLastControlResult()!==false?" (Error code: "+af.getLastControlResult()+")":"";Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.starting_office_failed")+ai})}}else{YAHOO.Bubbling.fire("metadataRefresh")}},50)}},250);var ah=new YAHOO.widget.SimpleDialog("prompt",{close:false,constraintoviewport:true,draggable:false,effect:null,modal:true,visible:true,zIndex:9999});var ag="message.edit-online-aos.plugin_blocked.body.firefox";if(af.isFirefox()){ag="message.edit-online-aos.plugin_blocked.body.firefox"}else{if(af.isChrome()){ag="message.edit-online-aos.plugin_blocked.body.chrome"}else{if(af.isSafari()){ag="message.edit-online-aos.plugin_blocked.body.safari"}}}ah.setHeader(this.msg("message.edit-online-aos.plugin_blocked.caption"));ah.setBody(this.msg(ag));ah.cfg.queueProperty("buttons",[{text:this.msg("message.edit-online-aos.plugin_blocked.button_dismiss"),handler:function(){window.clearInterval(ac);this.destroy()},isDefault:true}]);ah.render(document.body);ah.center();ah.show()}else{if(af.getLastControlResult()!==-2){var ab=af.getLastControlResult()!==false?" (Error code: "+af.getLastControlResult()+")":"";Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.starting_office_failed")+ab})}}}else{YAHOO.Bubbling.fire("metadataRefresh")}},_aos_tryToLaunchOfficeByMsProtocolHandler:function T(ah,af,ae){var ab=af+":ofe%7Cu%7C"+ae;var ag=false;var ac=document.createElement("input");var ad=document.body.scrollTop+10;ac.setAttribute("style","z-index: 1000; background-color: rgba(0, 0, 0, 0); border: none; outline: none; position: absolute; left: 10px; top: "+ad+"px;");document.getElementsByTagName("body")[0].appendChild(ac);ac.focus();ac.onblur=function(){ag=true};location.href=ab;setTimeout(function(){ac.onblur=null;ac.remove();if(!ag){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.supported_office_version_required")})}},500)},_aos_launchOfficeOnIos:function v(af,ad,ac){var ab=ad+":ofe%7Cu%7C"+af.encodeUrl(ac);var ae=document.createElement("iframe");ae.setAttribute("style","display: none; height: 0; width: 0;");document.getElementsByTagName("body")[0].appendChild(ae);ae.src=ab},getProtocolForFileExtension:function(ac){var ab={doc:"ms-word",docx:"ms-word",docm:"ms-word",dot:"ms-word",dotx:"ms-word",dotm:"ms-word",xls:"ms-excel",xlsx:"ms-excel",xlsb:"ms-excel",xlsm:"ms-excel",xlt:"ms-excel",xltx:"ms-excel",xltm:"ms-excel",xlsm:"ms-excel",ppt:"ms-powerpoint",pptx:"ms-powerpoint",pot:"ms-powerpoint",potx:"ms-powerpoint",potm:"ms-powerpoint",pptm:"ms-powerpoint",potm:"ms-powerpoint",pps:"ms-powerpoint",ppsx:"ms-powerpoint",ppam:"ms-powerpoint",ppsm:"ms-powerpoint",sldx:"ms-powerpoint",sldm:"ms-powerpoint"};return ab[ac]},onActionSimpleRepoAction:function e(ag,ac){if(ac.title.indexOf("_deactivated")==-1){var ae=this.getAction(ag,ac).params,ak=ag.displayName,aj=["function","action","success","successMessage","failure","failureMessage"],ah={};for(var ab in ae){if(ae.hasOwnProperty(ab)&&!Alfresco.util.arrayContains(aj,ab)){ah[ab]=ae[ab]}}var ai=ac.title;ac.title=ac.title+"_deactivated";var ad={success:{event:{name:"metadataRefresh",obj:ag}},failure:{message:this.msg(ae.failureMessage,ak),fn:function af(){ac.title=ai},scope:this},webscript:{method:Alfresco.util.Ajax.POST,stem:Alfresco.constants.PROXY_URI+"api/",name:"actionQueue"},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{actionedUponNode:ag.nodeRef,actionDefinitionName:ae.action,parameterValues:ah}}};if(YAHOO.lang.isFunction(this[ae.success])){ad.success.callback={fn:this[ae.success],obj:ag,scope:this}}if(ae.successMessage){ad.success.message=this.msg(ae.successMessage,ak)}if(YAHOO.lang.isFunction(this[ae.failure])){ad.failure.callback={fn:this[ae.failure],obj:ag,scope:this}}if(ae.failureMessage){ad.failure.message=this.msg(ae.failureMessage,ak)}this.modules.actions.genericAction(ad)}},onActionFormDialog:function o(ad,ab){var af=this.getAction(ad,ab),ah=af.params,ae={title:this.msg(af.label)},ac=ad.displayName;delete ah["function"];var ag=ah.success;delete ah.success;ae.success={fn:function(ai,aj){if(YAHOO.lang.isFunction(this[ag])){this[ag].call(this,ai,aj)}YAHOO.Bubbling.fire("metadataRefresh",aj)},obj:ad,scope:this};if(ah.successMessage){ae.successMessage=this.msg(ah.successMessage,ac);delete ah.successMessage}if(YAHOO.lang.isFunction(this[ah.failure])){ae.failure={fn:this[ah.failure],obj:ad,scope:this};delete ah.failure}if(ah.failureMessage){ae.failureMessage=this.msg(ah.failureMessage,ac);delete ah.failureMessage}ae.properties=ah;Alfresco.util.PopupManager.displayForm(ae)},onActionUploadNewVersion:function l(ad){var ac=ad.jsNode,ah=ad.displayName,ai=ac.nodeRef,ae=ad.version;if(!this.fileUpload){this.fileUpload=Alfresco.getFileUploadInstance()}var aj=this.msg("label.filter-description",ah),af="*";if(ah&&new RegExp(/[^\.]+\.[^\.]+/).exec(ah)){af="*"+ah.substring(ah.lastIndexOf("."))}if(ad.workingCopy&&ad.workingCopy.workingCopyVersion){ae=ad.workingCopy.workingCopyVersion}var ag=0;if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||P.hasClass(this.id,"alf-fullscreen"))){ag=1000}var ab={updateNodeRef:ai.toString(),updateFilename:ah,updateVersion:ae,overwrite:true,filter:[{description:aj,extensions:af}],mode:this.fileUpload.MODE_SINGLE_UPDATE,onFileUploadComplete:{fn:this.onNewVersionUploadComplete,scope:this}};this.fileUpload.options.zIndex=ag;if(S(this.options.siteId)){ab.siteId=this.options.siteId;ab.containerId=this.options.containerId}this.fileUpload.show(ab)},_uploadComplete:function O(ab,af){var ag=ab.successful.length,ac,ae;if(ag>0){if(ag<(this.options.groupActivitiesAt||5)){for(var ad=0;ad<ag;ad++){ae=ab.successful[ad];ac={fileName:ae.fileName,nodeRef:ae.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-"+af,"document-details",ac)}}else{ac={fileCount:ag,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-"+af,"documentlibrary",ac)}}},onFileUploadComplete:function q(ab){this._uploadComplete(ab,"added")},onNewVersionUploadComplete:function z(ab){this._uploadComplete(ab,"updated")},onActionCancelEditing:function k(ac){var ab=ac.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.edit-cancel.success",ab)},failure:{message:this.msg("message.edit-cancel.failure",ab)},webscript:{method:Alfresco.util.Ajax.POST,name:"cancel-checkout/node/{nodeRef}",params:{nodeRef:ac.jsNode.nodeRef.uri}}});YAHOO.Bubbling.fire("editingCanceled",{record:ac})},onActionUnlockDocument:function aa(ac){var ab=ac.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.unlock-document.success",ab)},failure:{message:this.msg("message.unlock-document.failure",ab)},webscript:{method:Alfresco.util.Ajax.POST,name:"unlock-document/node/{nodeRef}",params:{nodeRef:ac.jsNode.nodeRef.uri}}})},onActionCopyTo:function j(ab){this._copyMoveTo("copy",ab)},onActionMoveTo:function f(ab){this._copyMoveTo("move",ab)},_copyMoveTo:function E(af,ad){if(!af in {copy:true,move:true}){throw new Error("'"+af+"' is not a valid Copy/Move to mode.")}if(!this.modules.copyMoveTo){this.modules.copyMoveTo=new Alfresco.module.DoclibCopyMoveTo(this.id+"-copyMoveTo")}var ae=Alfresco.module.DoclibGlobalFolder;var ac=[ae.VIEW_MODE_RECENT_SITES,ae.VIEW_MODE_FAVOURITE_SITES,ae.VIEW_MODE_SITE,ae.VIEW_MODE_SHARED];if(this.options.repositoryBrowsing===true){ac.push(ae.VIEW_MODE_REPOSITORY)}ac.push(ae.VIEW_MODE_USERHOME);var ag=0;if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||P.hasClass(this.id,"alf-fullscreen"))){ag=1000}var ab=ad[0]?ad[0].location.repoPath:ad.location.repoPath;this.modules.copyMoveTo.setOptions({allowedViewModes:ac,mode:af,siteId:this.options.siteId,containerId:this.options.containerId,path:this.options.repositoryBrowsing?ab:this.currentPath,files:ad,rootNode:this.options.repositoryBrowsing?this.modules.copyMoveTo.options.rootNode:this.options.rootNode,parentId:this.getParentNodeRef(ad),zIndex:ag}).showDialog()},onActionAssignWorkflow:function d(ac){var ag="",ab=this.getParentNodeRef(ac);if(YAHOO.lang.isArray(ac)){for(var ae=0,ad=ac.length;ae<ad;ae++){ag+=(ae===0?"":",")+ac[ae].nodeRef}}else{ag=ac.nodeRef}var af={selectedItems:ag};if(ab){af.destination=ab}Alfresco.util.navigateTo(F("start-workflow"),"POST",af)},onActionManagePermissions:function K(ab){if(!this.modules.permissions){this.modules.permissions=new Alfresco.module.DoclibPermissions(this.id+"-permissions")}this.modules.permissions.setOptions({siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:ab}).showDialog()},onActionManageAspects:function s(ab){if(!this.modules.aspects){this.modules.aspects=new Alfresco.module.DoclibAspects(this.id+"-aspects")}this.modules.aspects.setOptions({file:ab}).show()},onActionChangeType:function r(af){var ab=af.jsNode,ag=ab.type,ai=af.displayName,ac=Alfresco.constants.PROXY_URI+G("slingshot/doclib/type/node",ab.nodeRef.uri);var aj=function ae(al){al.addValidation(this.id+"-changeType-type",function ak(ar,an,aq,ap,am,ao){return ar.options[ar.selectedIndex].value!=="-"},null,"change",null,{validationType:"mandatory"})};this.modules.changeType=new Alfresco.module.SimpleDialog(this.id+"-changeType").setOptions({width:"30em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/change-type?currentType="+encodeURIComponent(ag),actionUrl:ac,doSetupFormsValidation:{fn:aj,scope:this},firstFocus:this.id+"-changeType-type",onSuccess:{fn:function ah(ak){YAHOO.Bubbling.fire("metadataRefresh",{highlightFile:ai});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.success",ai)})},scope:this},onFailure:{fn:function ad(ak){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.failure",ai)})},scope:this}});this.modules.changeType.show()},viewInSourceRepositoryURL:function p(ad,af){var ae=ad.node,ac=ad.location.repositoryId,ab=this.options.replicationUrlMapping,ag;if(!ac||!ab||!ab[ac]){return"#"}ag=ae.isContainer?af.folderDetailsUrl:af.documentDetailsUrl;ag=ag.substring(Alfresco.constants.URL_CONTEXT.length);return G(ab[ac],"/",ag)},onActionCloudSync:function U(ab){if(!i){i=new Alfresco.module.DoclibCloudFolder(this.id+"-cloud-folder");var ad=this;YAHOO.Bubbling.on("folderSelected",function ae(ah,ag){this.updateSyncOptions();Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetdefinitions",dataObj:YAHOO.lang.merge(this.options.syncOptions,{memberNodeRefs:ad.getMemberNodeRefs(this.options.files),remoteTenantId:this.options.targetNetwork,targetFolderNodeRef:ag[1].selectedFolder.nodeRef}),successCallback:{fn:function ai(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.sync.success")})},scope:this},failureMessage:this.msg("message.sync.failure")})},i)}else{var af=i.widgets.optionInputs;if(af){for(var ac=0;ac<af.length;ac++){af[ac].checked=af[ac].defaultChecked}}}if(!this.modules.cloudAuth){this.modules.cloudAuth=new Alfresco.module.CloudAuth(this.id+"cloudAuth")}i.setOptions({files:ab});this.modules.cloudAuth.setOptions({authCallback:i.showDialog,authCallbackContext:i}).checkAuth()},onActionCloudUnsync:function D(ad){var ai=this,ah=ad.jsNode.isContainer?"folder":"document",ac=ad.displayName,ag=(this.options.syncMode==="CLOUD"),ab=ag?"":'<div><input type="checkbox" id="requestDeleteRemote" class="requestDeleteRemote-checkBox"><span class="requestDeleteRemote-text">'+this.msg("sync.remove."+ah+".from.cloud",ac)+"</span></div>";Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+ah+".cloud-unsync"),noEscape:true,text:this.msg("message.unsync.confirm",ac)+ab,buttons:[{text:this.msg("button.unsync"),handler:function ae(){var aj=ag?false:P.getAttribute("requestDeleteRemote","checked");this.destroy();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetmembers/"+ad.jsNode.nodeRef.uri+"?requestDeleteRemote="+aj,method:Alfresco.util.Ajax.DELETE,successCallback:{fn:function ak(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:ai.msg("message.unsync.success")})},scope:ai},failureMessage:ai.msg("message.unsync.failure")})}},{text:this.msg("button.cancel"),handler:function af(){this.destroy()},isDefault:true}]})},onCloudSyncIndicatorAction:function A(ab,af){var ad=new Alfresco.util.createInfoBalloon(this.widgets.dataTable.getTrEl(af),{text:this.msg("label.loading"),width:"455px"});ad.show();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib2/node/"+ab.nodeRef.replace("://","/"),successCallback:{fn:function ae(ah){var ai=this,ag={showTitle:true,showRequestSyncButton:true,showUnsyncButton:true,showMoreInfoLink:true};Alfresco.util.getSyncStatus(this,ab,ah.json,ag,function(ak){if(ak!=null){ad.html(ak.html);ad.requestsync=Alfresco.util.createYUIButton(ai,"button-requestsyn",function(){ai.onActionCloudSyncRequest(ab);ad.hide()},{id:ai.id});if(!ak.showRequestSyncButton&&ad.requestsync!=null){ad.requestsync.setStyle("display","none")}ad.unsync=Alfresco.util.createYUIButton(ai,"button-unsync",function(){ai.onActionCloudUnsync(ab);ad.hide()},{id:ai.id});if(!ak.showUnsyncButton&&ad.unsync!=null){ad.unsync.setStyle("display","none")}var aj=ad.content;Alfresco.util.syncClickOnShowDetailsLinkEvent(ai,aj);Alfresco.util.syncClickOnHideLinkEvent(ai,aj);Alfresco.util.syncClickOnTransientErrorShowDetailsLinkEvent(ai,aj);Alfresco.util.syncClickOnTransientErrorHideLinkEvent(ai,aj)}else{ad.hide()}})},scope:this},failureCallback:{fn:function ac(ag){Alfresco.util.PopupManager.displayMessage({text:this.msg("sync.unable.get.details")})},scope:this}})},onActionCloudSyncRequest:function w(ab,ad){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncrequest",dataObj:{memberNodeRefs:this.getMemberNodeRefs(ab)},successCallback:{fn:function ac(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.request.sync.success")})},scope:this},failureMessage:this.msg("message.request.sync.failure")})},getMemberNodeRefs:function a(ab){var ad=new Array();if(YAHOO.lang.isArray(ab)){for(var ac in ab){ad.push(ab[ac].nodeRef)}}else{ad.push(ab.nodeRef)}return ad},onCloudSyncFailedIndicatorAction:function C(ab,ac){this.onCloudSyncIndicatorAction(ab,ac)},onCloudIndirectSyncIndicatorAction:function W(ab,ac){this.onCloudSyncIndicatorAction(ab,ac)},onCloudIndirectSyncFailedIndicatorAction:function J(ab,ac){this.onCloudSyncIndicatorAction(ab,ac)},onActionFolderDownload:function u(ab){var ac=Alfresco.getArchiveAndDownloadInstance(),ad={nodesToArchive:[{nodeRef:ab.nodeRef}],archiveName:ab.fileName};ac.show(ad)},onActionDownload:function n(ab){var ac=Alfresco.getArchiveAndDownloadInstance(),ad={nodesToArchive:[]};if(ab.length==1){ad.nodesToArchive.push({nodeRef:ab[0].nodeRef});ad.archiveName=ab[0].fileName}else{for(var ae=0;ae<ab.length;ae++){ad.nodesToArchive.push({nodeRef:ab[ae].nodeRef})}}ac.show(ad)}}})();